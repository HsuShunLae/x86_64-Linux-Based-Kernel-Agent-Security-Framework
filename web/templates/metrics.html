<!DOCTYPE html>
<html>
<head>
  <title>Pipeline Metrics</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-slate-900 text-slate-200 p-6">
<div class="max-w-7xl mx-auto">
  <div class="flex items-center justify-between mb-6">
	  <h1 class="text-2xl font-semibold text-indigo-400 mb-6">
	    Pipeline Job Metrics
	  </h1>
	  <a href="/" class="text-sm text-indigo-300 hover:underline">
      	       <- Back
   	 </a>
  </div>

  <canvas id="jobChart" height="120"></canvas>
</div>

<script>
fetch("/api/metrics/all")
  .then(r => r.json())
  .then(jobs => {
    if (!jobs.length) return;

    const labels = jobs.map(j => j.job_id.slice(0, 8));
    const duration = jobs.map(j => j.duration_ms ?? 0);
    const ram = jobs.map(j => j.peak_ram_mb ?? 0);
    const cpu = jobs.map(j => j.avg_cpu ?? 0);
    const disk = jobs.map(j => j.disk_mb ?? 0);

    new Chart(document.getElementById("jobChart"), {
      type: "bar",
      data: {
        labels,
        datasets: [
          {
            label: "Duration (ms)",
            data: duration,
            backgroundColor: "rgba(99,102,241,0.6)"
          },
          {
            label: "Peak RAM (MB)",
            data: ram,
            backgroundColor: "rgba(34,197,94,0.6)"
          },
          {
            label: "Avg CPU (%)",
            data: cpu,
            backgroundColor: "rgba(239,68,68,0.6)"
          },
          {
            label: "Disk I/O (MB)",
            data: disk,
            backgroundColor: "rgba(245,158,11,0.6)"
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: "Value" }
          }
        }
      }
    });
  });
</script>
</body>
</html>

